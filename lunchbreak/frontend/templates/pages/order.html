{% extends 'base.html' %}

{% block content %}

{% set header_class='white' %}

{% set gocardless = store.staff is defined and store.staff.is_merchant %}

<div id="checkout" class="block fullsize">
    <div class="container">
        <div id="checkout-before" class="title-split">
            <h1>Bestellen bij {{ store.name }}</h1>
            <div>
                <a href="{{ url('frontend-store', pk=store.id) }}" class="subscript">Bestelling annuleren</a>
            </div>
        </div>

        <form method="POST">
            {% csrf_token %}
            <div class="split-column">
                <label>{{ user_form.name.label }}
                    {{ user_form.name }}
                    {{ forms.render_errors(user_form.name.errors) }}
                </label>


                <label>Telefoonnummer
                    <input type="text" value="{{ request.user.phone }}" disabled/>
                </label>

                <label>{{ user_form.email.label }}
                    {{ user_form.email }}
                    {{ forms.render_errors(user_form.email.errors) }}
                </label>

                {% set memberships = request.user.memberships.select_related(
                        'group'
                    ).all()
                %}

                {% if memberships %}
                <label>Bestelling plaatsen in een groep
                    <select name="checkout-group">
                        <option>Bestelling niet in een groep plaatsen</option>
                        {% for membership in request.user.memberships.all() %}
                        <option>{{Â membership.group.name }}</option>
                        {% endfor %}
                    </select>
                </label>
                {% endif %}

                <div class="radio-container">
                    <label>Betaalmethode</label>
                    <div>
                        <label class="radio-item mdl-radio mdl-js-radio mdl-js-ripple-effect" for="checkout-payment-0">
                          <input type="radio" id="checkout-payment-0" class="mdl-radio__button" name="{{ order_form.payment_method.html_name }}" value="{{ order_form.fields['payment_method'].choices[0][0] }}" checked>
                          <span class="mdl-radio__label">{{ order_form.fields['payment_method'].choices[0][1] }}</span>
                        </label>

                        <label class="radio-item mdl-radio mdl-js-radio mdl-js-ripple-effect" for="checkout-payment-1">
                          <input type="radio" id="checkout-payment-1" class="mdl-radio__button" name="{{ order_form.payment_method.html_name }}" value="{{ order_form.fields['payment_method'].choices[1][0] }}" {% if not gocardless %}disabled{% endif %}>
                          <span class="mdl-radio__label">{{ order_form.fields['payment_method'].choices[1][1] }}</span>
                        </label>
                    </div>
                    {% if not gocardless %}
                    <p class="subscript">
                        Deze winkel heeft online betalingen uitgeschakeld.
                    </p>
                    {% endif %}
                    {{ forms.render_errors(order_form.payment_method.errors) }}
                </div>

                <input type="submit" value="Bestelling plaatsen"/>
                <p class="subscript">De definitieve prijs kan licht verschillen vanwege de afgewogen hoeveelheid bij de bereiding van gewogen producten.</p>
            </div>

            <div class="split-column">
                <div id="checkout-receipt">
                    {{ order_form.receipt }}
                    {{ forms.render_errors(order_form.receipt.errors) }}
                </div>

                <label>Opmerking bij de bestelling
                    <textarea name="checkout-comment" placeholder="Extra extra mayonaise graag!"></textarea>
                </label>

                {% set orderedfoods = order.orderedfood.all() %}
                {% include 'includes/orderedfood.html' %}
            </div>
        </form>
    </div>
</div>

{% include 'includes/header.html' %}

<script src="{{ static('mdlComponentHandler.js') }}" type="text/javascript"></script>
<script src="{{ static('radio/radio.js') }}" type="text/javascript"></script>

{% endblock content %}
